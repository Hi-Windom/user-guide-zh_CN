模板片段用于在光标插入符位置快速插入之前设置好的文本内容，支持变量。
{: id="20210104091309-h61sdjr"}

## 模板文件夹
{: id="20210104091309-lrtes9o"}

在名为 `templates` 的文件夹下的文档都将被视作模板文档，模板文件夹可以放置在笔记本根目录下，也可以在任何层级的文件夹下。
{: id="20210104091309-6icwamk"}

模板文档中的内容块不会被((20200817123136-in6y5m1 "内容块引用"))搜索到，仅作为模板文本使用。
{: id="20210104091309-r4ht9qi"}

## 编写模板
{: id="20210104091309-fhb549c"}

模板片段和普通文档最大的区别在于模板里可以编写变量，这些变量在使用模板的时候会进行填充渲染。模板使用的是 [Go 编程语言的文本模板](https://golang.org/pkg/text/template/)进行实现，如果你对此有了解的话，可以实现一些程序逻辑在里面，比如比较逻辑、迭代逻辑等。
{: id="20210104091309-siekt4x"}

如果不太了解也没关系，因为直接使用变量是模板最常用的用法。我们通过开源项目 [Sprig](https://github.com/Masterminds/sprig) 内置了一些变量和函数来简化模板使用。其中最常用的就是通过 `{{now | date "2006-01-02 15:04:05​"}}` 来渲染当前时间，更多用法可参考 [Sprig 帮助文档](http://masterminds.github.io/sprig/)。
{: id="20210104091309-mvyh081"}

关于日期时间格式化有个细节需要#注意#：Go 编程语言的格式化比较“另类”，不是使用 `yyyy-MM-dd HH:mm:ss`，而是使用 `2006-01-02 15:04:05` 这个固定时间格式（[知乎讨论](https://www.zhihu.com/question/366830553)）。
{: id="20210104091309-vnxe81t"}

除了 Sprig 内置的变量和函数，还支持如下变量和函数：
{: id="20210104091309-os47lco"}

* {: id="20210104091309-p88fqma"}`title`：通过该变量可以快速插入当前文档名。比如模板内容为 `# {{.title}}`，则调用后会以一级标题语法插入到当前文档内容中
  {: id="20210131155558-loq0tt3"}
* {: id="20210121193601-uwo8s5h"}`sql`：通过该函数用于查询数据库，参数为 SQL 语句：`{{ sql "SELECT * FROM blocks LIMIT 7" }}`
  {: id="20210131155558-ghlchbx"}
{: id="20210104091309-gjkg3u5"}

## 调用模板
{: id="20210104091309-h71ogwf"}

在光标插入符位置，输入 `{{` 后将触发模板搜索，继续输入可按模板文档名称进行过滤，找到需要插入的模板后回车即可。#注意#：不支持跨笔记本调用模板。
{: id="20210104091309-l9wcdtk"}

## 一个示例
{: id="20210104091309-2p68yju"}

```plaintext
{{$before := (div (now.Sub (toDate "2006-01-02" "2020-02-19")).Hours 24)}}

{{$after := (div ((toDate "2006-01-02" "2048-02-19").Sub now).Hours 24)}}
今天是 `{{now | date "2006-01-02"}}`。

* 距离 `2020-02-19` 已经过去 `{{$before}}` 天
* 距离 `2048-02-19` 还剩 `{{$after}}` 天
```
{: id="20210104091309-9ppkq6j"}

`$before` 和 `$after` 定义了两个变量，分别记录当前日期距离 2020 年和 2048 年的天数。
{: id="20210104091309-06sv04x"}

## 上架模板集市
{: id="20210131162925-p51ey8q"}

上架前请确认你的模板仓库根路径下至少包含这两个文件（[仓库示例](https://github.com/88250/November-Rain)）：
{: id="20210131162925-ececb6c"}

* {: id="20210131162925-mzvnu0y"}template.json（请确保 JSON 格式正确）
  {: id="20210131162925-owpf9yl"}
* {: id="20210131162925-kvgwgr7"}preview.png（请压缩图片大小在 128 KB 以内）
  {: id="20210131162925-m5sxpc7"}
{: id="20210131162925-lyyl9sm"}

确认无误以后请通过对[社区集市](https://github.com/siyuan-note/bazaar)仓库[发起 pull request](https://docs.github.com/cn/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request)，修改 templates.json 文件。该文件是所有社区模板仓库的索引，格式为：
{: id="20210131162925-ld2wv38"}

```json
{
  "repos": [
    "username/reponame@commithash"
  ]
}
```
{: id="20210131162925-01ixzvb"}

其中 `commithash` 请填写你的模板仓库上最近一次发布版本的 Git 提交哈希值，请使用完整哈希值，不要使用 7 位短值。
{: id="20210131162925-tos2g00"}

#### 更新
{: id="20210131162925-e2aq6sa"}

如果你开发的模板更新了版本，请记得：
{: id="20210131162925-1q8zsu9"}

* {: id="20210131162925-kxy0t2r"}更新你的模板配置 template.json 中的 version 字段
  {: id="20210131162925-vg6sggf"}
* {: id="20210131162925-g7efau2"}再次对社区集市发起 Pull Request
  {: id="20210131162925-3qgjytc"}
{: id="20210131162925-z512z4z"}


{: id="20201204181006-7bkppue" type="doc"}
